# ---- Globales Nginx-Tuning (http-Kontext) ----
# Für WebSockets/Upgrade: definiert $connection_upgrade
map $http_upgrade $connection_upgrade {
  default upgrade;
  ''      close;
}

# Größere Header-/Cookie-/Proxy-Puffer für NextAuth
client_max_body_size            20m;
client_header_buffer_size       64k;
large_client_header_buffers     8 64k;

# Proxy-Puffer (Antwort-Header/Set-Cookie vom Upstream)
proxy_buffer_size               256k;
proxy_buffers                   16 256k;
proxy_busy_buffers_size         512k;

# Zeitlimits
proxy_connect_timeout           30s;
proxy_send_timeout              180s;
proxy_read_timeout              180s;

# HTTP/1.1 für Upstreams (WebSocket etc.)
proxy_http_version              1.1;

# Seltene Header mit Unterstrich (optional)
underscores_in_headers          on;
